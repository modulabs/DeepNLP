ANonparametricDelayedFeedbackModelforConversionRatePredictionYuyaYoshikawa1,YusakuImai21STAIRLab,ChibaInstituteofTechnology2CyberAgent,Inc.yoshikawa@stair.center,y24twentyfour@gmail.comAbstractPredictingconversionrates(CVRs)indisplayad-vertising(e.g.,predictingtheproportionofuserswhopurchaseanitem(i.e.,aconversion)afteritscorrespondingadisclicked)isimportantwhenmeasuringtheeffectsofadsshowntousersandtounderstandingtheinterestsoftheusers.Thereisgenerallyatimedelay(i.e.,so-calleddelayedfeed-back)betweentheadclickandconversion.Owingtothedelayedfeedback,samplesthatareconvertedafteranobservationperiodmaybetreatedasneg-ative.Toovercomethisdrawback,CVRpredictionassumingthatthetimedelayfollowsanexponentialdistributionhasbeenproposed.Inpractice,how-ever,thereisnoguaranteethatthedelayisgener-atedfromtheexponentialdistribution,andthebestdistributionwithwhichtorepresentthedelayde-pendsonthedata.Inthispaper,weproposeanon-parametricdelayedfeedbackmodelforCVRpre-dictionthatrepresentsthedistributionofthetimedelaywithoutassumingaparametricdistribution,suchasanexponentialorWeibulldistribution.Be-causethedistributionofthetimedelayismodeleddependingonthecontentofanadandthefeaturesofauser,variousshapesofthedistributioncanberepresentedpotentially.Inexperiments,weshowthattheproposedmodelcancapturethedistribu-tionforthetimedelayonasyntheticdataset,evenwhenthedistributioniscomplicated.Moreover,onarealdataset,weshowthattheproposedmodeloutperformstheexistingmethodthatassumesanexponentialdistributionforthetimedelayintermsofconversionrateprediction.1IntroductionPredictingconversionrates(CVRs)indisplayadvertising(e.g.,theproportionofuserswhopurchaseanitem(i.e.,conversion)afteritscorrespondingadisclicked)isimpor-tantwhenmeasuringtheeffectsofadvertisementsshowntousersandtounderstandingtheinterestsoftheusers.There-fore,themodelsforCVRpredictionhasbeenwell-studiedforseveralyears[Leeetal.,2012;Rosalesetal.,2012;Jietal.,2017].IDClickdateConversion dateAd feature1â€¦Userfeature 1â€¦12018/01/0410:12:152018/01/1216:30:020.1â€¦10.3â€¦22018/01/0508:42:33unobserved0.3â€¦8.4â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦n2018/03/3022:50:11unobserved0.8â€¦12.2â€¦Figure1:Anexampleofaconversionlogdatabase.Eachrow(sam-ple)includestheclickdate,conversiondate,adfeaturesanduserfeatures.Ifthesamplehasnotyetbeenconverted,itsconversiondateisrecordedasâ€˜unobservedâ€™.ConversionlogsarestoredinadatabaselikethatshowninFigure1.Betweentheadclickandconversion,atimedelay(i.e.,theso-calleddelayedfeedback)basicallyoccurs.Asaresult,theconversiondatesofthesamplesthathavenotbeenconvertedbytheendoftheobservationperiodarerecordedasâ€˜unobservedâ€™inthedatabase.BecausethetimedelayoftheCVRisfromhourstodays,theratioofsuchsamplesinthedatabaseisrelativelylarge[Chappelleetal.,2014].Suchsamplescannaivelybetreatedasnegativesampleswhenatrainingconversionmodelisbasedonlogisticre-gressionorasupportvectormachine.However,ifsomeofthesesamplesareeventuallyconverted,themodelislearnedonsampleswithincorrectlabels,resultinginpoorCVRpre-diction.ItisthusnecessaryinpracticetoconstructCVRpre-dictionmodelsconsideringthedelayedfeedback.Todealwiththisdrawback,ChapelleproposedaCVRpredictionmodelthatconsidersdelayedfeedback[Chapelle,2014].Here,thetimedelaysoftheconversionfollowanex-ponentialdistribution.AsshowninFigure5in[Chapelle,2014],however,theactualdistributionoftimedelaysisoftennon-exponentialandperiodic,andtheshapeofthedistribu-tionvariesbythesample.Thus,forthedistributionoftimedelaysforconversion,itismoredesirablenottoassumeanyshapeofthedistribution,suchasanexponentialorWeibulldistribution,andbeabletochangethedistributiontoï¬tthesample.Inthispaper,weproposeanonparametricdelayedfeedbackmodel(NoDeFforshort)forCVRpredictionthatrepresentsthedistributionofthetimedelaywithoutassuminganyparametricdistributions.NoDeFpartiallyborrowstheideasofkerneldensityestimation(KDE).Morespeciï¬cally,thedistributionforthetimedelayisdeï¬nedaccordingtotheweightedsumofkernelvaluesoftheconversiontimeandpseudo-pointsonthetimeaxis,wheretheweightsarelearnedfromdata.Then,aswith[Chapelle,2014],NoDeFassumesthateachsamplehasahiddenvariableindicatingwhetheritwillbeconvertedeventually.Inparameterestimation,whileestimatingtheassignmentofthehiddenvariable,theCVRpredictionmodelislearnedbytheEMalgorithm[Dempsteretal.,1977].NoDeFisageneralframeworkthatcanbeusedfornotonlyCVRpredictionindisplayadvertisementbutalsovariouscircumstancesinwhichdelayedfeedbackoccurs.Inexperiments,wedemonstratetheeffectivenessoftheproposedmodelonsyntheticandrealdatasets.Onthesyn-theticdataset,weshowthatNoDeFcanestimatetheshapeofthedistributionofthetimedelayfromdata.Ontherealdataset,weshowthatNoDeFcanpredicttheCVRfortestsamples,comparingwithexistingmethods.2RelatedWorkAsdescribedinSection1,NoDeFextendsthedelayedfeed-backmodelproposedby[Chapelle,2014].Theirmodelas-sumesthatthedistributionofatimedelayfollowsanexpo-nentialdistributionwithparametersdeterminedbytheinputsample.[Jietal.,2017]laterproposedamodelforwhichthedistributionisamixtureofWeibulldistributions,and[Sa-farietal.,2017]proposedanefï¬cientsolutionforthedelayedfeedbackmodelwithaWeibulldistribution.Tothebestofourknowledge,thepresentstudyistheï¬rsttorepresentthedis-tributionofdelayedfeedbacknonparametricallyintheCVRpredictionmodel.NoDeFwasinspiredbyanideaof[Duetal.,2012]torepresenttimedelaysofinformationdiffusiononsocialnet-worksbynonparametricdistributions.BecausethepresentstudydealswiththeproblemofCVRprediction,themathe-maticalformulationsofthepreviousandpresentpapersareessentiallydifferent.Moreover,weextendtheformulationofthedistributionofthetimedelaytobeabletopredictthedistributionforunseensamples.Anothertopicwellstudiedrecentlyindisplayadvertisingisthemulti-touchattributionsetting,whichconsidersthatusersareaffectedbytheadvertisementofanitemviapossiblymultipleadvertisingchannels,suchasdisplay,socialandpaidsearchadvertising.Modelsthatcorrectlymeasuretheeffectofanadineachchannelwhileconsideringthetimedelaybe-tweenclickandconversionhavebeenproposed[Zhangetal.,2015;Jietal.,2016;JiandWang,2017].Here,thedistribu-tionofthetimedelayinmulti-touchattributionalsofollowsanexponentialorWeibulldistribution.TheideaofNoDeFwouldthusbeusefulformodelingmulti-touchattribution.3Preliminary:SurvivalAnalysisThissectionbrieï¬‚yintroducesthetheoryofsurvivalanalysisrequiredtoexplainNoDeF.Survivalanalysiswasoriginallyconductedtoanalyzethetimeuntiloneormoreeventshappen,suchasthedeathofabiologicalorganismorthefailureofamechanicalsys-tem[KleinbaumandKlein,2012].Inrecentyears,survivalTable1:NotationsVariableDescriptionxiâˆˆRMAfeaturevectorfortheithsamplerepresentingitsadanduser,whereMisthelengthofthefeaturevector.yiâˆˆ{0,1}Anobservedbinaryvalueofwhethertheithsampleisconverted.diâˆˆ[0,âˆž]Thedelaytimebetweentheclickandtheconversionfortheithsample.Ifnotconverted,di=âˆž.eiâˆˆ[0,âˆž)Theelapsedtimesincetheclickfortheithsample.ciâˆˆ{0,1}Ahiddenbinaryvalueofwhethertheithsamplewillbeconvertedeventu-ally.VâˆˆRLÃ—MAparametermatrixforthetimede-laymodel,Listhenumberofpseudo-pointsplacedontimeaxis.wâˆˆRMAparametervectorfortheconversionmodel.analysishasalsobeenconductedtomodelusersâ€™opinionfor-mation[Yuetal.,2017]andinformationpropagationphe-nomenaonsocialnetworks[Rodriguezetal.,2013]intheareaofdatamining.GivenarandomvariableT>0correspondingtothetimethataneventhappens,f(t)isdeï¬nedastheprobabilityden-sityofTandF(t)=Rt0f(x)dxisitscumulativedistributionfunction.Theprobabilitythataneventdoesnothappenuptotimetisgivenasthesurvivalfunctions(t)=1âˆ’F(t).Theeventratethataneventhasnotyethappeneduptotimetbuthappensattimetisthendeï¬nedbyahazardfunctionh(t).Therelationshipamongh(t),f(t)ands(t)ish(t)=f(t)s(t).(1)Furthermore,thesurvivalfunctions(t)canbederivedusinghazardfunctionh(t):s(t)=exp(cid:18)âˆ’Zt0h(x)dx(cid:19).(2)4ProposedModelThissectionexplainstheformulationofNoDeFandthelearn-ingalgorithmforNoDeFbasedontheEMalgorithm.Supposethatweobserveasetofnquadruplets,denotedD={(xi,yi,di,ei)}ni=1.Inparticular,xiâˆˆRMrepresentsthefeaturevectorfortheithadanduser,whereMisthelengthofthefeaturevector.yiâˆˆ{0,1}isabinaryvariableindicatingwhethertheithsampleisconverted.diâˆˆ[0,âˆž]isthedelaybetweentheclickandtheconversionfortheithsample.Ifthereisnoconversion,di=âˆž.eiâˆˆ[0,âˆž)isthetimeelapsedsincetheclick.Table1summarizesthenotationofvariablesusedforNoDeF.hazard function â„Ž(ð‘‘;ð’™,ð‘½)â„Ž(ð‘‘;ð’™,ð‘½)ð›¼*(ð’™;ð‘½)ð‘˜(ð‘¡*,ð‘‘)ð‘¡-ð‘¡.ð‘¡/ð‘¡0ð‘¡1ð‘¡2time ð‘‘Figure2:Relationshipamongthehazardfunctionh,intensityfunc-tionÎ±landkernelkinNoDeF.TheyellowdottedlineindicatesÎ±l(x;V)ateachtimetlwhilethepalebluelineindicatestheker-nelfunctionvaluek(tl,d)ateachtimetl.Thedarkbluelineisthehazardfunctionh(d;x,V).4.1ModelNoDeFisconstructedfromtwoprobabilisticmodels.Theï¬rstmodel,whichwerefertoasthetimedelaymodel,isusedtorepresentthetimedelaysbetweentheclickandconversion.Thesecondmodel,whichwerefertoastheconversionmodel,isaclassiï¬erthatpredictswhetheranewlycominguserisconvertedforanewlydisplayedad.NoDeFisajointmodelofthesetwomodels.InNoDeF,wedeï¬nethetimedelaymodelaccordingtotheframeworkofsurvivalanalysisasdescribedinSection3.Thedistributionofthetimedelayvariesaccordingtothecon-tentsoftheaddisplayedandthecharacteristicsoftheuserswhowatchthead.Thus,inNoDeF,wedeï¬nethetimede-laymodelwithoutassuminganydistribution,suchasanex-ponentialorWeibulldistribution,suchthattheshapeofthedistributioncanbedeterminedbythecontentsoftheadandthecharacteristicsoftheusers.Weï¬rstexplainthehazardfunctionforNoDeF.Todeï¬nethehazardfunction,NoDeFplacesLâˆˆN+equallyspacedpseudo-points{tlâ‰¥0}Ll=1onthetimeaxis.Thehazardfunc-tion(i.e.,theratethattheconversionfortheithsamplehasnotyethappeneduptotimedibuthappensattimedi)isthendeï¬nedash(di;xi,V)=LXl=1Î±l(xi;V)k(tl,di),(3)wherekisakernelfunctionreturningapositivevalue.In-tuitively,thevalueofthekernelfunctionrepresentsthesim-ilaritybetweentwopointsonthetimeaxis.Here,onecanusekernelfunctionsasksuchthatk(tl,Ï„),Ra0k(tl,Ï„)dÏ„andRâˆžak(tl,Ï„)dÏ„fortl,Ï„,aâ‰¥0canbecalculatedanalytically.Forexample,aGaussiankernelwithbandwidthparameterh>0canbeusedforNoDeF.Inthiscase,theabovethreevaluesareobtainedask(tl,Ï„)=exp(cid:18)âˆ’(tlâˆ’Ï„)22h2(cid:19),(4)Za0k(tl,Ï„)dÏ„=âˆ’hrÏ€2(cid:20)erf(cid:18)tlâˆ’aâˆš2h(cid:19)âˆ’erf(cid:18)tlâˆš2h(cid:19)(cid:21),(5)Zâˆžak(tl,Ï„)dÏ„=hrÏ€2(cid:20)1+erf(cid:18)tlâˆ’aâˆš2h(cid:19)(cid:21).(6)Î±lisanintensityfunctionwithweightsVâˆˆRLÃ—M,whichcontrolsakernelvalueforthelthpseudo-pointtlonthetimeaxis,deï¬nedbyÎ±l(xi;V)=(cid:16)1+exp(cid:16)âˆ’V>lxi(cid:17)(cid:17)âˆ’1.(7)Figure2illustratestherelationshipamongthehazardfunc-tionh,intensityfunctionÎ±landkernelkin(3).Theformulationofthehazardfunction(3)borrowstheideasofKDE.However,thetwodifferontwopoints.First,thehazardfunctioncontrolsthemagnitudeofthedensitybytheintensityfunctionÎ±lthathasafeaturevectorxiasin-put,whileKDErepresentsthemagnitudeofthedensitybythenumberofdatapoints.Second,thehazardfunctioncom-putesthekernelvaluesofaninputtimepointdiandonlyLpseudo-points{tl}Ll=1tocalculatethedensity,whileKDEneedstocomputethekernelvaluesoftheinputtimepointandalltheobservedtimepointswhosesizeisgenerallylargerthanL.Thehazardfunctioncanthusbecomputedquicklyforanewlycomingfeaturevector.Accordingtothedeï¬nitionofthesurvivalfunction(2)and(3),thesurvivalfunctionforNoDeFiss(di;xi,V)=exp âˆ’Zdi0h(Ï„;xi,V)dÏ„!(8)=exp âˆ’LXl=1Î±l(xi;V)Zdi0k(tl,Ï„)dÏ„!.Asin[Chapelle,2014],weconsiderforeachsampleahid-denvariableciâˆˆ{0,1},whichindicateswhethertheithsampleisconvertedregardlessofthetimeelapseduntiltheconversion.Ifyi=1(i.e.,theithsamplehasbeencon-verted),thenci=1obviously.Meanwhile,ifyi=0(i.e.,theithsamplehasnotbeenconvertedbeforetheelapsedtimeei),thencicannotbedetermined.Thus,forsamplessuchthatyi=0,weneedtoestimatetheassignmentofciduringlearning.Wethendeï¬netheprobabilitythattheconversionhap-penedattimedifortheithsample.Accordingtothehazardfunction(3)andthesurvivalfunction(8),theprobabilitythattheconversionhappenedattimedifortheithsamplecanbecalculatedaccordingtop(di|xi,ci=1)=s(di;xi,V)h(di;xi,V).(9)Notethatthisprobability(9)isundeï¬nedinthecaseofthesampleforwhichci=0.Withtheconversionmodel,onecanuseanybinaryclassi-ï¬erwhoselikelihoodisdifferentiable,suchaslogisticregres-sionandneuralnetworkclassiï¬ers.Inthispaper,wesimplyuselogisticregressiondeï¬nedasp(ci=1|xi;w)=(cid:0)1+exp(âˆ’w>xi)(cid:1)âˆ’1,(10)p(ci=0|xi;w)=1âˆ’p(ci=1|xi),(11)wherewâˆˆRMisaweightvectorfortheconversionclassi-ï¬er.Wethendeï¬nethelikelihoodforNoDeF.Forthesakeofconvenience,wedeï¬netwosetsofsampleindices:I1={i|yi=1,i=1,2,Â·Â·Â·,n},(12)I0={i|yi=0,i=1,2,Â·Â·Â·,n}.(13)WerespectivelyrefertoI1andI0asthepositivesamplesetandnegativesampleset.GivenparametersÎ˜={V,w},thelikelihoodofobserva-tionD={(xi,yi,di,ei)}ni=1canbefactorizedasp(D;Î˜)=nYi=1Xciâˆˆ{0,1}p(yi|xi,ci,ei)p(ci|xi)p(di|xi,ci=1).(14)Notethatifci=0,yi=0mustbetrue.Theequationsp(yi=0|xi,ci=0,ei)=1,(15)p(yi=1|xi,ci=0,ei)=0(16)arethussatisï¬edconsistently.Therefore,byplugging(15)and(16)intolikelihood(14)anddividingthesampleindicesintotwosetsI1andI0,thelikelihoodcanbedeformedasp(D;Î˜)=YiâˆˆI1p(ci=1|xi)p(di|yi=1,xi)(17)Ã—YiâˆˆI0Xciâˆˆ{0,1}p(yi=0|xi,ci,ei)p(ci|xi).p(yi=0|xi,ci=1,ei)istheprobabilitythattheconversionhasnothappenedbeforeelapsedtimeeifortheithsampleandthattheconversionwillhappenafterward.Thisprobabil-itycanbecalculatedasp(yi=0|xi,ci=1,ei)(18)=p(di>ei|xi,ci=1,ei)(19)=1âˆ’Zei0p(di=Ï„|ci=1,xi)dÏ„(20)=s(ei;xi,V),(21)wherethetransformationfrom(20)to(21)isperformedbyapplyingthefactthats(t)=1âˆ’F(t)describedinSection3.4.2LearningAlgorithmThissectionexplainsthelearningalgorithmforNoDeFde-rivedonthebasisoftheEMalgorithm.Weï¬rstdeï¬netheobjectivefunctioninastandardwayfortheEMalgorithm.AccordingtoJensenâ€™sinequality,alowerboundQ(Î˜;Â¯Î˜)forthelogarithmoflikelihood(14)canbederivedaslogp(D;Î˜)â‰¥Q(Î˜;Â¯Î˜)(22)=XiâˆˆI1loghp(ci=1|xi)p(di|xi,ci=1)i+XiâˆˆI0Xciâˆˆ{0,1}Â¯qiciloghp(yi|xi,ci,ei)p(ci|xi)i,whereÂ¯qiciisaposteriorofcideï¬nedasÂ¯qic=p(ci=c|xi,yi=0,ei)(23)âˆp(yi=0|xi,ci=c,ei)p(ci=c|xi).Ifc=0,p(yi=0|xi,ci=c,ei)musthavethevalue1obviously.Thus,Â¯qi0=p(ci=0|xi,yi=0,di,ei)âˆp(ci=0|xi),(24)whichcanbecalculatedusing(11).Meanwhile,ifc=1,theposteriorofcicanbecalculatedaccordingtoÂ¯qi1=p(ci=1|xi,yi=0,di,ei)âˆp(ci=1|xi)p(yi=0|xi,ci=1,ei),(25)wherep(ci=1|xi)andp(yi=0|xi,ci=1,ei)arere-spectivelycalculatedusing(10)and(18).NotethatÂ¯qicob-tainedusing(24)and(25)needstobenormalizedbyÂ¯qic=Â¯qic/(Â¯qi0+Â¯qi1).TheE-stepistoupdatetheposteriorofciunderthecurrentestimatesofparametersÎ˜.IntheM-step,weupdatetheparametersÎ˜employingagradient-basedoptimizationmethodsuchasthegradientde-scentmethodorquasi-Newtonmethod,ï¬xingtheposteriorofci.Inthispaper,weuseL-BFGS[LiuandNocedal,1989],anefï¬cientimplementationofthequasi-Newtonmethod,whichneedstheï¬rst-ordergradientsoftheobjectivefunction(22)withrespecttotheparametersÎ˜.Wehereaddâ€˜2regulariz-ersforwandVto(22),whicharerespectivelycontrolledbystrengthparametersÎ»w,Î»Vâ‰¥0.TheseregularizersareidenticaltoputGaussianpriorswithzeromeanandprecisionÎ»wandÎ»Vforthem.First,thegradientwithrespecttowiscalculatedasâˆ‚Q(Î˜;Â¯Î˜)âˆ‚w=XiâˆˆI1âˆ‚âˆ‚wlogp(ci=1|xi)(26)+XiâˆˆI0Xciâˆˆ{0,1}Â¯qicâˆ‚âˆ‚wlogp(ci|xi)âˆ’Î»ww,where,âˆ‚âˆ‚wlogp(ci=1|xi)=x(1âˆ’p(ci=1|xi)),(27)âˆ‚âˆ‚wlogp(ci=0|xi)=âˆ’xp(ci=1|xi).(28)Second,thegradientwithrespecttoVliscalculatedasâˆ‚Q(Î˜;Â¯Î˜)âˆ‚Vl=XiâˆˆI1âˆ‚âˆ‚Vllogp(di|xi,ci=1)(29)+XiâˆˆI0Xciâˆˆ{0,1}Â¯qicâˆ‚âˆ‚Vllogp(yi=0|xi,ci,ei)âˆ’Î»VVl,where,âˆ‚âˆ‚Vllogp(di|xi,ci=1)=âˆ‚âˆ‚Vllogs(di;xi,V)+âˆ‚âˆ‚Vllogh(di;xi,V),(30)âˆ‚âˆ‚Vllogp(yi=0|xi,ci=1,ei)=âˆ‚âˆ‚Vllogs(ei;xi,V),(31)âˆ‚âˆ‚Vllogs(di;xi,V)=âˆ’xiÎ±l(x;V)(1âˆ’Î±l(x;V))Zdi0k(tl,Ï„)dÏ„,(32)âˆ‚âˆ‚Vllogh(di;xi,V)=xiÎ±l(x;V)(1âˆ’Î±l(x;V))k(tl,di)h(di;xi,V).(33)WeiterativelyestimatetheparametersÎ˜byalternatingE-andM-stepsuntilconvergingtheobjectivefunction(22).Insummary,thelearningalgorithmforNoDeFisshowninAl-gorithm1.Here,lbfgsupdatewandlbfgsupdateVarefunctionsthatreturnwandVupdatedusingL-BFGS,andtheargumentsaretheinitialvaluesoftheparametersandthegradientsoftheparameters.Algorithm1ParameterestimationofNoDeFbyEM-algorithmInput:trainingsetD,kernelfunctionk,maximumiterationsNâˆˆN+,tolerance>0.//Parameterinitializationw(0)âˆ¼N(0,1),V(0)âˆ¼N(0,1),Î˜(0)={w(0),V(0)}//Parameterestimationforj=1,2,Â·Â·Â·,Ndo//E-stepcomputationforiâˆˆI0doforcâˆˆ{0,1}doÂ¯qic=p(ci=c|xi,yi=0,ei)//using(24)endforendfor//M-stepcomputationw(j)=lbfgsupdatew(w(jâˆ’1),âˆ‚âˆ‚wQ(Î˜;Î˜(jâˆ’1)))V(j)=lbfgsupdateV(V(jâˆ’1),âˆ‚âˆ‚VQ(Î˜;Î˜(jâˆ’1)))Î˜(j)={w(j),V(j)}//CheckingstopconditionifQ(Î˜(j);Î˜(jâˆ’1))âˆ’Q(Î˜(jâˆ’1);Î˜(jâˆ’2))<thenbreakendifendforOutput:Î˜(j)Selectionofhyperparameters.NoDeFhasfourhyperpa-rameters:thenumberofpseudo-pointsL,bandwidthforGaussiankernelh,precisionparametersÎ»wandÎ»V.Thehyperparameterscanbedeterminedbycross-validationorbyusingavalidationset.Asanothermethodofdeterminingh,onecanusethelengthbetweentwoneighboringpseudo-pointsti+1,tibecausethepseudo-pointsareplacedatequalintervalsasshowninFigure2.Werecommendusingh=(ti+1âˆ’ti)/2toestimateasmoothdistributionforthetimedelay.ThismethodisconsistentlyusedintheexperimentsdescribedinSection5.4.3PredictionAftertheparametersareestimated,NoDeFcanperformtwotypesofprediction.Theï¬rstistopredictwhetheranewlycomingsamplewillbeconverted,regardlessoftheelapsedtimeofdelayedfeedback.Inthiscase,theCVRcanbeob-tainedbysimplyapplyingconversionclassiï¬er(10)forthesample.Thesecondtypeofpredictionistopredictwhetherthenewlycomingsamplewillbeconvertedupuntilthetimecho-sen.Inthiscase,theprobabilitythatthesamplexwillbeconvertedupuntilobservationtimeperiodEâ‰¥0canbecal-culatedasp(y=1|x,c=1,E)=p(c=1|x)p(d<E|c=1,x)=p(c=1|x)ZE0p(t|c=1,x)dt=p(c=1|x)(1âˆ’s(E;x,V)).(34)Notethattheï¬rstpredictioncorrespondsto(34)whenE=âˆžbecauseRâˆž0p(t|c=1,x)dt=1.0.00.20.40.60.81.0Normalized time delay0.00.20.40.60.81.0DensityNoDeFExp (MLE)True dist.(a)alldata0.00.20.40.60.81.0Normalized time delay0.00.20.40.60.81.0DensityNoDeFExp (MLE)True dist(c)pattern20.00.20.40.60.81.0Normalized time delay0.00.20.40.60.81.0DensityNoDeFExp (MLE)True dist(b)pattern10.00.20.40.60.81.0Normalized time delay0.00.20.40.60.81.0DensityNoDeFExp (MLE)True dist(d)pattern3Figure3:Estimationresultsoftheprobabilitydensityfunctiononthesyntheticdataset.ThebluesolidlineindicatesNoDeFwithL=40,Î»w=0.01,Î»V=0.01,thereddashedlineindicatesanexponentialdistributionï¬ttedbyMLE,andthegreenhistogramindicatesthetruedistribution.Thevalueofdensityforeachmethodisnormalizedsuchthatthemaximumvalueis1.5ExperimentsThissectionpresentstheresultsofexperimentsonsyntheticandrealdatasets.5.1ExperimentsonSyntheticDatasetThissubsectionshowshowthecorrectNoDeFcanestimatethecomplicatedshapeofadistributionofthetimedelayonasyntheticdataset.Datasetgeneration.Thesyntheticdatasetisgeneratedfromamixtureofthreedifferentdistributionssothatthesin-gledatasetincludesthreetypesofconversionbehaviorpat-terns.Fortheï¬rstpattern,thenumberofsamplesis100,a10-dimensionalfeaturevectorxâˆˆR10foreachsampleisgeneratedfromanormaldistributionN(âˆ’3,1),anddelaytimedâ‰¥0foreachsampleisgeneratedfromatruncatednormaldistributionTN(1,1)thattruncatesvalueslessthan0andgreaterthan10.Forthesecondpattern,thenumberofsamplesis70,thefeaturevectorforeachsampleisgener-atedfromanormaldistributionN(0,1),andthedelaytimeforeachsampleisgeneratedfromatruncatednormaldistri-butionTN(4,1).Forthethirdpattern,thenumberofsam-plesis30,thefeaturevectorforeachsampleisgeneratedfromanormaldistributionN(3,1),andthedelaytimeforeachsampleisgeneratedfromatruncatednormaldistribu-tionTN(7,1).Forallsamples,theelapsedtimeeissetto10andlabelyâˆˆ{0,1}isdeterminedrandomlyfromanuniformdistribution.Results.Figure3showstheestimateddensitycorrespond-ingto(9)onthesyntheticdataset.Forcomparison,wedis-playtheexponentialdistributionï¬ttedbymaximumlikeli-hoodestimation(MLE),whichisusedin[Chapelle,2014]Table2:TheaveragepredictiveperformanceforallthecampaignsontheCriteodataset.Theboldfaceindicatesthebestvaluesineachofthemetrics.LoglossAccuracyAUCNAIVE0.3571Â±0.0060.8714Â±0.0030.7349Â±0.007DFM0.3450Â±0.0080.8702Â±0.0040.7423Â±0.009NoDeF0.3438Â±0.0080.8725Â±0.0030.7387Â±0.009Table3:Theaveragepredictiveperformancefortherecentcam-paignsontheCriteodataset.ThenotationisthesameasTable2.LoglossAccuracyAUCNAIVE0.2818Â±0.0210.9124Â±0.0130.7187Â±0.019DFM0.3689Â±0.0510.9151Â±0.0120.7213Â±0.022NoDeF0.2575Â±0.0200.9157Â±0.0120.7242Â±0.025formodelingthetimedelay.AsshowninFigure3(a),NoDeFcancorrectlyreconstructthreepeaksofthetruedistribution.Panels(b)â€“(d)thenshowtheestimateddensitywhenfeaturevectorsforeachofthethreepatternsaregiven.Asshownintheï¬gures,NoDeFcancorrectlyestimatethedensityassoci-atedwitheachpatternusingtheinputtedfeaturevectors.5.2ExperimentsontheCriteoDatasetThissubsectionpresentstheeffectivenessofNoDeFintermsofthepredictiveperformanceontheCriteodataset,whichisapopularconversionlogdatasetusedin[Chapelle,2014].Datasetpreparation.Aswith[Chapelle,2014],weusetwotypesoftheCriteodataset.Theï¬rstoneincludesthecon-versionlogsassociatedwithallthecampaigns,whilethesec-ondoneincludesthoseassociatedwiththerecentcampaigns.Foreachofthetwodataset,weï¬rstextractsixperiods.Foreachperiod,wedividethesamplesintheperiodintotraining,validationandtestsets.Thetrainingsetcomprises50,000sampleswhoseclickdateiswithintheï¬rstthreedays.Here,theconversiondateisreplacedwithâ€˜unobservedâ€™whentheconversiondateofthesamplesexceedstheï¬rstthreedays.Thevalidationsetcomprises10,000sampleswhoseclickdateisbetweentheï¬naldayofthetrainingsetandthenextday.Thetestsetcomprises10,000sampleswhoseclickdateisbetweentheï¬naldayofthevalidationsetandthenextday.Forthevalidationandtestsets,thesampleswhoseconversiondateexceedstheï¬naldayoftheirsetsaretreatedasnegativesamples.Foreachsample,thereareeightfeaturestakingintegerval-uesandninecategoricalfeatures.Werepresenteachofthecategoricalfeaturesasaone-hotvectorandthenconcatenatetheintegerfeaturesandtheirone-hotvectors.Thedimension-alityoftheresultingfeaturevectoris2,594.Wethenreducethedimensionalityofthefeaturevectorsto100byconductingprincipalcomponentanalysis.SettingofNoDeF.ForNoDeF,weusethenormalizedlogvaluesofthedelayandelapsedtimesofeachsample.ThehyperparametersofNoDeF,Lâˆˆ{10,20,30},Î»wâˆˆ{1.0,0.1,0.01}andÎ»Vâˆˆ{1.0,0.1,0.01}areoptimizedus-ingthevalidationsetofthedataset.hisdeterminedbythemethoddescribedinthelastparagraphofSection4.2.Settingofcomparingmethods.Forcomparison,weusetwomethodsthatarereferredtoasDFMandNAIVE.These0.00.20.40.60.81.0Normalized log time delay0.00.20.40.60.81.0Normalized densityNoDeFRaw data(a)L=100.00.20.40.60.81.0Normalized log time delay0.00.20.40.60.81.0Normalized densityNoDeFRaw data(b)L=20Figure4:TheestimateddensitiesforthetimedelayinNoDeFwithdifferentL.TheotherhyperparametersaresettoÎ»w=0.1,Î»V=0.1.hisautomaticallydeterminedasdescribedinSection4.2.methodswereusedby[Chapelle,2014].DFMistheirpro-posedmethodthatconsidersthedelayedfeedbackusinganexponentialdistributionforthetimedelay.NAIVEisabase-linemethodthatusesalogisticregressionmodel1andtreatssamplesforwhichtheconversionisunobservedasnegativesamples.ThehyperparametersinDFMandNAIVEarede-terminedusingthevalidationsetofthedataset.ForDFM,wenormalizethedelaytimeandelapsetimeofeachsamplebytheobservedmaximumdelaytimeinthetrainingset.Results.Tables2and3showthepredictiveperformanceonthetwotypesoftheCriteodatasets.TheresultsindicatethatNoDeFoutperformsNAIVEandDFMintermsoflogloss,accuracyandAUC,exceptfortheAUCvalueforallthecampaignsontheCriteodataset.Then,Figure4showstheestimateddensitiesforthetimedelayinNoDeFwithdiffer-entL.Theï¬guresshowsthatNoDeFcouldcapturethetwopeaksappearingintherawdatawithoutthepriorknowledgeofthedistributionoftherawdata.Then,sincethedensitiesaresmoothfordifferentL,thisindicatesthattheautomateddeterminationofhforNoDeFiseffective.6ConclusionWeproposedanonparametricdelayedfeedbackmodel(NoDeF)forthepredictionoftheconversionrateindis-playedadvertising.Unlikeexistingdelayedfeedbackmod-els,NoDeFcanestimatethedistributionforthetimedelaybetweenanadclickandconversionnonparametrically.Bydoingso,NoDeFrepresentscomplicateddistributionsforthetimedelaythatcannotbecapturedbyparametricdistribu-tions,suchasexponentialandWeibulldistributions.Inex-periments,weshowedthatNoDeFbetterï¬ttedacomplicateddistributiononasyntheticdatasetthantheexistingmodelthatassumesanexponentialdistributionforthetimedelay,andoutperformedothermodelsintermsofthepredictiveperfor-manceontheCriteodataset.Infuturework,toupdatetheparametersofNoDeFassoonaspossibleusingthelatestconversionlogs,wewillattempttodevelopanefï¬cientlearningalgorithmbasedonthestochas-ticEMalgorithm[Nielsen,2000]forNoDeF.Inaddition,wewilldemonstratetheeffectivenessoftheideaofNoDeFbyapplyingthemodeltothemulti-touchattributionsetting.1WeusedtheimplementationoflogisticregressioninScikit-learn0.19.0.http://scikit-learn.org/.References[Chapelle,2014]OlivierChapelle.ModelingDelayedFeed-backinDisplayAdvertising.Proceedingsofthe20thACMSIGKDDInternationalConferenceonKnowledgeDiscov-eryandDataMining,pages1097â€“1105,2014.[Chappelleetal.,2014]OliverChappelle,ErenManavoglu,andRomerRosales.SimpleandScalableResponsePre-dictionforDisplayAdvertising.ACMTransactionsonIn-telligentSystemsandTechnology,5(4):Article61,2014.[Dempsteretal.,1977]ArthurPDempster,NanMLaird,andDonaldBRubin.MaximumLikelihoodfromIncom-pleteDataviatheEMAlgorithm.JournaloftheRoyalStatisticalSociety.SeriesB(Methodological),1977.[Duetal.,2012]NanDu,LeSong,MingYuan,andAlexJSmola.LearningNetworksofHeterogeneousInï¬‚uence.AdvancesinNeuralInformationProcessingSystems25,pages2780â€“2788,2012.[JiandWang,2017]WendiJiandXiaolingWang.Addi-tionalMulti-TouchAttributionforOnlineAdvertising.Proceedingsofthe31thConferenceonArtiï¬cialIntelli-gence,pages1360â€“1366,2017.[Jietal.,2016]Ji,WWang,XZhang,andDell.AProba-bilisticMulti-TouchAttributionModelforOnlineAdver-tising.InInternationalConferenceonInformationandKnowledgeManagement.AssociationforComputingMa-chinery,2016.[Jietal.,2017]WendiJi,XiaolingWang,andFeidaZhu.Time-AwareConversionPrediction.FrontiersofCom-puterScience,11(4):702â€“716,2017.[KleinbaumandKlein,2012]DavidG.KleinbaumandMitchelKlein.SurvivalAnalysis.StatisticsforBiologyandHealth.SpringerNewYork,NewYork,NY,2012.[Leeetal.,2012]Kuang-chihLee,BurkayOrten,AliDas-dan,andWentongLi.EstimatingConversionRateinDis-playAdvertisingfromPastErformanceData.InProceed-ingsofthe18thACMSIGKDDInternationalConferenceonKnowledgeDiscoveryandDataMiningg,page768,NewYork,NewYork,USA,2012.ACMPress.[LiuandNocedal,1989]DongC.LiuandJorgeNocedal.OntheLimitedMemoryBFGSMethodforLargeScaleOptimization.MathematicalProgramming,45(1-3):503â€“528,aug1989.[Nielsen,2000]SÃ¸renFeodorNielsen.TheStochasticEMAlgorithm:EstimationandAsymptoticResults.Bernoulli,6(3):457,jun2000.[Rodriguezetal.,2013]ManuelGomezRodriguez,JureLeskovec,andBernhardSchoelkopf.ModelingInforma-tionPropagationwithSurvivalTheory.InProceedingsofThe30thInternationalConferenceonMachineLearning,2013.[Rosalesetal.,2012]RÂ´omerRosales,HaibinCheng,andErenManavoglu.Post-ClickConversionModelingandAnalysisforNon-GuaranteedDeliveryDisplayAdvertis-ing.InProceedingsoftheFifthACMInternationalCon-ferenceonWebSearchandDataMining,page293,NewYork,NewYork,USA,2012.ACMPress.[Safarietal.,2017]AbdollahSafari,RachelMacKayAlt-man,andThomasM.Loughin.DisplayAdvertising:Esti-matingConversionProbabilityEfï¬ciently.arXivpreprint,oct2017.[Yuetal.,2017]LinyunYu,PengCui,ChaomingSong,TianyangZhang,andShiqiangYang.ATemporallyHet-erogeneousSurvivalFrameworkwithApplicationtoSo-cialBehaviorDynamics.InProceedingsofthe23rdACMSIGKDDInternationalConferenceonKnowledgeDiscov-eryandDataMining,pages1295â€“1304,2017.[Zhangetal.,2015]YaZhang,YiWei,andJianbiaoRen.Multi-touchAttributioninOnlineAdvertisingwithSur-vivalTheory.InIEEEInternationalConferenceonDataMining,numberJanuary,pages687â€“696,2015.
